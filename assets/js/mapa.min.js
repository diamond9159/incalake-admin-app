console.log("Loading mapa.min.js",Date() );

  var markers = [];
  var bounds  = null;

  var map = null, markerBounds = null;
  var points = {lugares: [] };
  var markerPosition = null;
  var newDataMarker = null;
  
  function initAutocomplete() {
    bounds = new google.maps.LatLngBounds();
    //var haightAshbury = {lat: -15.8422, lng: -70.0199};
    /***************************************************************************************************/
    /***************************************************************************************************/
    map = new google.maps.Map(document.getElementById('mapaLugares'), {
      center: {lat: -15.8422, lng: -70.0199},
      zoom: 13
    });
    /************************************** END AUTOCOMPLETADOR ****************************************/

    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
      var div_name = $(this).data("div");
      //console.log("TAB: #"+div_name);
      switch(div_name){
        case 'div_mapa':
          initAutocomplete();
          addMarker(points.lugares);
        break;
        default:

        break;
      }
    });

    markerBounds = new google.maps.LatLngBounds();
    autocomplete2 = new google.maps.places.Autocomplete((document.getElementById('txt_nombre_lugar')),
      {types: ["establishment", "geocode"]});
    autocomplete2.addListener('place_changed', setInformation);
    markerPosition = new google.maps.Marker({
      map:map,
      draggable:true,
      animation: google.maps.Animation.DROP,
      position: null,
      icon: 'http://www.googlemapsmarkers.com/v1/009900/'
    });
    map.addListener('click', function(event) {
      var latlngClick = JSON.parse( JSON.stringify( event.latLng) );
      markerPosition.setPosition( event.latLng );
      //setPositionMarker(event.latLng);
    });
    google.maps.event.addListener(markerPosition,"dragend",function(event){
      //setPositionMarker(event.latLng);
    });
  }

function setInformation(){
  var place = autocomplete2.getPlace();
  var latlng = JSON.parse( JSON.stringify( place.geometry.location) );
  
  document.getElementById("txtr_descripcion_lugar").value = place.formatted_address;
  document.getElementById("txt_coordenadas_lugar").value = latlng.lat+","+latlng.lng;
  markerPosition.setPosition(place.geometry.location);
}
function addMarker(dataJsonMarkers) {
  if ( dataJsonMarkers.length != 0 ) {
    for(var i in dataJsonMarkers){
      var arrayCoordenadas = (dataJsonMarkers[i]['coordenadas']).split(','); 
      new google.maps.Marker({
        position: new google.maps.LatLng( parseFloat(arrayCoordenadas[0]), parseFloat(arrayCoordenadas[1]) ), 
        map: map,
        label: ""+(parseInt(i)+1),
        title: ""+dataJsonMarkers[i]['nombre'],
      });
      markerBounds.extend(new google.maps.LatLng( parseFloat(arrayCoordenadas[0]), parseFloat(arrayCoordenadas[1]) ) ); 
    }
    map.fitBounds(markerBounds);
    document.getElementById("map_prod").value = JSON.stringify(points.lugares);
  }else{
    map.setCenter({lat: -15.8422, lng: -70.0199});
  }
}

  $(document).on('click', '.btn-add-point', function(event) {
    event.preventDefault();
    var txt_nombre_lugar      = $("#txt_nombre_lugar").val();
    var txt_descripcion_lugar = $("#txtr_descripcion_lugar").val();
    var txt_coordenadas       = $("#txt_coordenadas_lugar").val();
    var txt_tipo_lugar        = $("#slct_tipo_lugar").val();
    //var txt_orden_lugar       = $("#txt_numero_orden_lugar").val();
    if ( txt_nombre_lugar.length === 0 ) {
      swal("Error..!","Complete el campo Nombre del Lugar","warning");
      $("#txt_nombre_lugar").focus();
    }else if( txt_coordenadas.length === 0 ){
      swal("Error..!","Busque el lugar o escriba para seleccionar un lugar y obtener sus coordenadas.","warning");
      $("#txt_nombre_lugar").focus();
    }else if(txt_tipo_lugar.length === 0 ){
      swal("Error..!","Seleccione el tipo de Lugar","warning");
    }else{
      var marker = {
        idb: null,
        idl: null,
        nombre: txt_nombre_lugar,
        descripcion: txt_descripcion_lugar,
        coordenadas: txt_coordenadas,
        tipo: txt_tipo_lugar,
        orden: (points.lugares.length + 1)
      };
      points.lugares.push(marker);
      addMarker(points.lugares);

      $('.span_cantidad_lugares').empty().append(points.lugares.length);
      //$('#map_prod').empty().val(JSON.stringify(points));

      $("#txt_nombre_lugar").val('');
      $("#txtr_descripcion_lugar").val('');
      $("#txt_coordenadas_lugar").val('');
      $("#slct_tipo_lugar").val('');
      //$("#txt_numero_orden_lugar").val(parseInt(txt_orden_lugar) + 1);
    }
  });

  $(document).on('click', '#btn_listar_lugares', function(event) {
    event.preventDefault();
      listarLugares();
      $('#modal-points-list').modal('show');
  });
  
  $(document).on('click', '.btn-eliminar-points', function(event) {
    event.preventDefault();
    //console.log($(this).data('id'));
    points.lugares.splice( parseInt( $(this).data('id')) , 1 );
    
    listarLugares();
    initAutocomplete();
    addMarker(points.lugares);
    $('#map_prod').empty().val(JSON.stringify(points.lugares));
    $('.span_cantidad_lugares').empty().append(points.lugares.length);
    $('#modal-reviews-list').modal('show');
  });

  function listarLugares(){
    var points_html  = '';
    if ( points.lugares.length === 0 ) {
      $('.modal-list-points').empty().append('No hay Lugares..!');
    }else{
      points_html +=  '<ul class="list-group">';
      $.each( points.lugares, function(index, val) {
        points_html +=  '<li class="list-group-item"><strong>'+val.orden+'.</strong> '+val.nombre+' <span class="fa fa-close btn-eliminar-points pull-right" data-id="'+index+'"></span></li>';
      });
      points_html += '</ul>';
      $('.modal-list-points').empty().append(points_html);
    }
  }